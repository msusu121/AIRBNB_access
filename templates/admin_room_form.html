{% extends "base.html" %}
{% block title %}{{ 'Edit Room' if room else 'New Room' }}{% endblock %}
{% block content %}
<div class="max-w-2xl">
  <div class="mb-4">
    <h1 class="text-2xl font-semibold tracking-tight">
      {{ 'Edit Room' if room else 'Create Room' }}
    </h1>
    <p class="text-sm text-slate-600 mt-1">
      Add a clear house/door number and an optional description.
    </p>
  </div>

  <div class="bg-white rounded-2xl shadow-sm ring-1 ring-slate-200">
    {# Resolve action to the exact endpoint names you have #}
    {% set action_url = url_for('admin.rooms_update', room_id=room.id) if room else url_for('admin.rooms_create') %}
    <!-- Debug: action="{{ action_url }}" -->
    <form method="post" action="{{ action_url }}" class="p-6 space-y-6" id="roomForm">
      <div class="space-y-1.5">
        <label for="name" class="text-sm font-medium text-slate-800">House Number</label>
        <input id="name" name="name" required maxlength="80"
               value="{{ room.name if room else '' }}"
               class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-4 focus:ring-slate-200"
               placeholder="e.g. A12, B-3, Penthouse 4" />
      </div>

      <div class="space-y-1.5">
        <label for="desc" class="text-sm font-medium text-slate-800">
          Description <span class="text-slate-400 font-normal">(optional)</span>
        </label>
        <textarea id="desc" name="desc" rows="4" maxlength="600"
                  class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm resize-y focus:outline-none focus:ring-4 focus:ring-slate-200"
                  placeholder="Floor, landmark, special accessâ€¦">{{ room.desc if room else '' }}</textarea>
        <div class="flex items-center justify-between">
          <p class="text-xs text-slate-500">Helpful for staff.</p>
          <span class="text-xs text-slate-400" id="descCount"></span>
        </div>
      </div>
    </form>

    <div class="border-t border-slate-200 bg-slate-50/60 rounded-b-2xl px-6 py-4 flex items-center justify-between">
      <div class="text-xs text-slate-500">
        Tip: <kbd class="px-1.5 py-0.5 rounded bg-white border">Ctrl</kbd> + <kbd class="px-1.5 py-0.5 rounded bg-white border">S</kbd> to save
      </div>
      <div class="flex items-center gap-2">
        <a href="{{ url_for('admin.rooms_index') }}" class="px-3 py-2 rounded-xl border border-slate-300 text-sm hover:bg-white">Cancel</a>
        <button type="submit" form="roomForm" class="px-4 py-2 rounded-xl bg-slate-900 text-white text-sm hover:bg-slate-800 focus:ring-4 focus:ring-slate-300">Save</button>
      </div>
    </div>
  </div>
</div>

<script>
  const desc = document.getElementById('desc');
  const counter = document.getElementById('descCount');
  function updateCount(){ if(desc && counter){ counter.textContent = `${desc.value.length}/600`; } }
  desc && (desc.addEventListener('input', updateCount), updateCount());

  document.addEventListener('keydown', (e)=>{
    if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){
      e.preventDefault();
      document.getElementById('roomForm').submit();
    }
  });
</script>
{% endblock %}
